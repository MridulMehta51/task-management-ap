<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #4a5568;
            font-size: 2rem;
        }

        .auth-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .login-form {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            margin: 50px auto;
        }

        .login-form h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #4a5568;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #718096;
        }

        .btn-danger {
            background: #e53e3e;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            align-items: start;
        }

        .event-form,
        .event-list {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .event-form h2,
        .event-list h2 {
            margin-bottom: 20px;
            color: #4a5568;
        }

        .event-card {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .event-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .event-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .event-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
            font-size: 0.9rem;
            color: #718096;
        }

        .event-description {
            color: #4a5568;
            margin: 15px 0;
            line-height: 1.6;
        }

        .event-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .hidden {
            display: none;
        }

        .error-message {
            background: #fed7d7;
            color: #c53030;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #feb2b2;
        }

        .success-message {
            background: #c6f6d5;
            color: #22543d;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #9ae6b4;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Authentication View -->
        <div id="login-view" class="login-form">
            <h2>Login to Event Manager</h2>
            <div id="login-error" class="error-message hidden"></div>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Username:</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">Login</button>
            </form>
            <p style="margin-top: 15px; text-align: center; color: #718096; font-size: 0.9rem;">
                Demo credentials:<br>
                <strong>admin</strong> / <strong>password</strong><br>
                <strong>user</strong> / <strong>123456</strong><br>
                <strong>demo</strong> / <strong>demo</strong>
            </p>
        </div>

        <!-- Main Application View -->
        <div id="app-view" class="hidden">
            <div class="header">
                <h1>Event Management System</h1>
                <div class="auth-section">
                    <span id="welcome-user"></span>
                    <button id="logout-btn" class="btn btn-secondary btn-small">Logout</button>
                </div>
            </div>

            <div class="main-content">
                <!-- Event Form (View) -->
                <div class="event-form">
                    <h2 id="form-title">Add New Event</h2>
                    <div id="form-message" class="hidden"></div>
                    <form id="event-form">
                        <input type="hidden" id="event-id">
                        <div class="form-group">
                            <label for="event-title">Event Title:</label>
                            <input type="text" id="event-title" required>
                        </div>
                        <div class="form-group">
                            <label for="event-description">Description:</label>
                            <textarea id="event-description" rows="4" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="event-date">Date:</label>
                            <input type="date" id="event-date" required>
                        </div>
                        <div class="form-group">
                            <label for="event-time">Time:</label>
                            <input type="time" id="event-time" required>
                        </div>
                        <div class="form-group">
                            <label for="event-location">Location:</label>
                            <input type="text" id="event-location" required>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn" id="submit-btn">Add Event</button>
                            <button type="button" class="btn btn-secondary" id="cancel-btn" style="display: none;">Cancel</button>
                        </div>
                    </form>
                </div>

                <!-- Events List (View) -->
                <div class="event-list">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>Upcoming Events</h2>
                        <button class="btn btn-secondary btn-small" onclick="controller.refreshEvents()" title="Refresh Events">
                            🔄 Refresh
                        </button>
                    </div>
                    <div id="events-container"></div>
                    <div id="storage-info" style="margin-top: 20px; padding: 15px; background: #f7fafc; border-radius: 8px; font-size: 0.9rem; color: #718096;">
                        <strong>Storage Info:</strong> <span id="storage-stats">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===============================
        // MODEL - Data and Business Logic
        // ===============================
        class EventModel {
            constructor() {
                // Persistent storage using localStorage
                this.storageKey = 'eventManagementApp';
                this.events = [];
                this.nextId = 1;
                this.loadFromStorage();
                
                // Initialize with sample data if no events exist
                if (this.events.length === 0) {
                    this.initializeSampleData();
                }
            }

            initializeSampleData() {
                // Add some sample events for demonstration
                this.events = [
                    {
                        id: 1,
                        title: "Team Meeting",
                        description: "Weekly team standup and project updates",
                        date: "2025-06-25",
                        time: "10:00",
                        location: "Conference Room A"
                    },
                    {
                        id: 2,
                        title: "Community Workshop",
                        description: "Web development workshop for beginners",
                        date: "2025-06-28",
                        time: "14:00",
                        location: "Community Center"
                    }
                ];
                this.nextId = 3;
                this.saveToStorage();
            }

            // Load events from localStorage
            loadFromStorage() {
                try {
                    const storedData = localStorage.getItem(this.storageKey);
                    if (storedData) {
                        const data = JSON.parse(storedData);
                        this.events = data.events || [];
                        this.nextId = data.nextId || 1;
                    }
                } catch (error) {
                    console.error('Error loading from storage:', error);
                    this.events = [];
                    this.nextId = 1;
                }
            }

            // Save events to localStorage
            saveToStorage() {
                try {
                    const dataToStore = {
                        events: this.events,
                        nextId: this.nextId,
                        lastUpdated: new Date().toISOString()
                    };
                    localStorage.setItem(this.storageKey, JSON.stringify(dataToStore));
                } catch (error) {
                    console.error('Error saving to storage:', error);
                }
            }

            // Create a new event
            createEvent(eventData) {
                const event = {
                    id: this.nextId++,
                    title: eventData.title,
                    description: eventData.description,
                    date: eventData.date,
                    time: eventData.time,
                    location: eventData.location,
                    createdAt: new Date().toISOString()
                };
                this.events.push(event);
                this.saveToStorage(); // Persist to localStorage
                return event;
            }

            // Read all events
            getAllEvents() {
                return [...this.events].sort((a, b) => {
                    const dateA = new Date(a.date + 'T' + a.time);
                    const dateB = new Date(b.date + 'T' + b.time);
                    return dateA - dateB;
                });
            }

            // Read a single event by ID
            getEventById(id) {
                return this.events.find(event => event.id === parseInt(id));
            }

            // Update an existing event
            updateEvent(id, eventData) {
                const index = this.events.findIndex(event => event.id === parseInt(id));
                if (index !== -1) {
                    this.events[index] = {
                        id: parseInt(id),
                        title: eventData.title,
                        description: eventData.description,
                        date: eventData.date,
                        time: eventData.time,
                        location: eventData.location,
                        createdAt: this.events[index].createdAt || new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    this.saveToStorage(); // Persist to localStorage
                    return this.events[index];
                }
                return null;
            }

            // Delete an event
            deleteEvent(id) {
                const index = this.events.findIndex(event => event.id === parseInt(id));
                if (index !== -1) {
                    const deletedEvent = this.events.splice(index, 1)[0];
                    this.saveToStorage(); // Persist to localStorage
                    return deletedEvent;
                }
                return null;
            }

            // Validate event data
            validateEvent(eventData) {
                const errors = [];
                
                if (!eventData.title || eventData.title.trim().length < 3) {
                    errors.push("Title must be at least 3 characters long");
                }
                
                if (!eventData.description || eventData.description.trim().length < 10) {
                    errors.push("Description must be at least 10 characters long");
                }
                
                if (!eventData.date) {
                    errors.push("Date is required");
                } else {
                    const eventDate = new Date(eventData.date);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    if (eventDate < today) {
                        errors.push("Date cannot be in the past");
                    }
                }
                
                if (!eventData.time) {
                    errors.push("Time is required");
                }
                
                if (!eventData.location || eventData.location.trim().length < 3) {
                    errors.push("Location must be at least 3 characters long");
                }
                
                return errors;
            }

            // Clear all events (for testing purposes)
            clearAllEvents() {
                this.events = [];
                this.nextId = 1;
                this.saveToStorage();
            }

            // Get storage statistics
            getStorageStats() {
                return {
                    totalEvents: this.events.length,
                    storageSize: JSON.stringify(this.events).length,
                    lastUpdated: new Date().toISOString()
                };
            }
        }

        // Authentication Model
        class AuthModel {
            constructor() {
                this.currentUser = null;
                this.authStorageKey = 'eventAppAuth';
                this.users = [
                    { username: 'admin', password: 'password', role: 'administrator' },
                    { username: 'user', password: '123456', role: 'user' },
                    { username: 'demo', password: 'demo', role: 'user' }
                ];
                this.loadAuthState();
            }

            // Load authentication state from localStorage
            loadAuthState() {
                try {
                    const storedAuth = localStorage.getItem(this.authStorageKey);
                    if (storedAuth) {
                        const authData = JSON.parse(storedAuth);
                        // Check if session is still valid (24 hours)
                        const sessionAge = Date.now() - new Date(authData.loginTime).getTime();
                        if (sessionAge < 24 * 60 * 60 * 1000) { // 24 hours
                            this.currentUser = authData.user;
                        } else {
                            this.clearAuthState();
                        }
                    }
                } catch (error) {
                    console.error('Error loading auth state:', error);
                    this.clearAuthState();
                }
            }

            // Save authentication state to localStorage
            saveAuthState() {
                try {
                    if (this.currentUser) {
                        const authData = {
                            user: this.currentUser,
                            loginTime: new Date().toISOString()
                        };
                        localStorage.setItem(this.authStorageKey, JSON.stringify(authData));
                    } else {
                        this.clearAuthState();
                    }
                } catch (error) {
                    console.error('Error saving auth state:', error);
                }
            }

            // Clear authentication state
            clearAuthState() {
                localStorage.removeItem(this.authStorageKey);
                this.currentUser = null;
            }

            login(username, password) {
                // Basic input validation
                if (!username || !password) {
                    return { success: false, error: 'Username and password are required' };
                }

                const user = this.users.find(u => u.username === username && u.password === password);
                if (user) {
                    this.currentUser = { 
                        username: user.username, 
                        role: user.role,
                        loginTime: new Date().toISOString()
                    };
                    this.saveAuthState();
                    return { success: true, user: this.currentUser };
                }
                return { success: false, error: 'Invalid username or password' };
            }

            logout() {
                this.clearAuthState();
            }

            isAuthenticated() {
                return this.currentUser !== null;
            }

            getCurrentUser() {
                return this.currentUser;
            }
        }

        // ===============================
        // VIEW - User Interface
        // ===============================
        class EventView {
            constructor() {
                this.initializeElements();
            }

            initializeElements() {
                // Authentication elements
                this.loginView = document.getElementById('login-view');
                this.appView = document.getElementById('app-view');
                this.loginForm = document.getElementById('login-form');
                this.loginError = document.getElementById('login-error');
                this.logoutBtn = document.getElementById('logout-btn');
                this.welcomeUser = document.getElementById('welcome-user');

                // Event form elements
                this.eventForm = document.getElementById('event-form');
                this.formTitle = document.getElementById('form-title');
                this.formMessage = document.getElementById('form-message');
                this.eventId = document.getElementById('event-id');
                this.eventTitle = document.getElementById('event-title');
                this.eventDescription = document.getElementById('event-description');
                this.eventDate = document.getElementById('event-date');
                this.eventTime = document.getElementById('event-time');
                this.eventLocation = document.getElementById('event-location');
                this.submitBtn = document.getElementById('submit-btn');
                this.cancelBtn = document.getElementById('cancel-btn');

                // Events list elements
                this.eventsContainer = document.getElementById('events-container');
            }

            showLoginView() {
                this.loginView.classList.remove('hidden');
                this.appView.classList.add('hidden');
            }

            showAppView(username) {
                this.loginView.classList.add('hidden');
                this.appView.classList.remove('hidden');
                this.welcomeUser.textContent = `Welcome, ${username}!`;
            }

            showLoginError(message) {
                this.loginError.textContent = message;
                this.loginError.classList.remove('hidden');
            }

            hideLoginError() {
                this.loginError.classList.add('hidden');
            }

            clearLoginForm() {
                this.loginForm.reset();
            }

            showFormMessage(message, isError = false) {
                this.formMessage.textContent = message;
                this.formMessage.className = isError ? 'error-message' : 'success-message';
                this.formMessage.classList.remove('hidden');
                setTimeout(() => {
                    this.formMessage.classList.add('hidden');
                }, 3000);
            }

            clearEventForm() {
                this.eventForm.reset();
                this.eventId.value = '';
                this.formTitle.textContent = 'Add New Event';
                this.submitBtn.textContent = 'Add Event';
                this.cancelBtn.style.display = 'none';
            }

            populateEventForm(event) {
                this.eventId.value = event.id;
                this.eventTitle.value = event.title;
                this.eventDescription.value = event.description;
                this.eventDate.value = event.date;
                this.eventTime.value = event.time;
                this.eventLocation.value = event.location;
                this.formTitle.textContent = 'Edit Event';
                this.submitBtn.textContent = 'Update Event';
                this.cancelBtn.style.display = 'inline-block';
            }

            renderEvents(events) {
                if (events.length === 0) {
                    this.eventsContainer.innerHTML = '<p style="text-align: center; color: #718096;">No events found. Add your first event!</p>';
                    return;
                }

                this.eventsContainer.innerHTML = events.map(event => `
                    <div class="event-card">
                        <div class="event-title">${this.escapeHtml(event.title)}</div>
                        <div class="event-description">${this.escapeHtml(event.description)}</div>
                        <div class="event-meta">
                            <div><strong>📅 Date:</strong> ${this.formatDate(event.date)}</div>
                            <div><strong>🕒 Time:</strong> ${this.formatTime(event.time)}</div>
                            <div><strong>📍 Location:</strong> ${this.escapeHtml(event.location)}</div>
                        </div>
                        <div class="event-actions">
                            <button class="btn btn-small" onclick="controller.editEvent(${event.id})">Edit</button>
                            <button class="btn btn-danger btn-small" onclick="controller.deleteEvent(${event.id})">Delete</button>
                        </div>
                    </div>
                `).join('');
            }

            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            }

            formatTime(timeString) {
                const [hours, minutes] = timeString.split(':');
                const date = new Date();
                date.setHours(parseInt(hours), parseInt(minutes));
                return date.toLocaleTimeString('en-US', { 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                });
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            getFormData() {
                return {
                    title: this.eventTitle.value.trim(),
                    description: this.eventDescription.value.trim(),
                    date: this.eventDate.value,
                    time: this.eventTime.value,
                    location: this.eventLocation.value.trim()
                };
            }

            getLoginData() {
                return {
                    username: document.getElementById('username').value.trim(),
                    password: document.getElementById('password').value
                };
            }
        }

        // ===============================
        // CONTROLLER - Application Logic
        // ===============================
        class EventController {
            constructor() {
                this.eventModel = new EventModel();
                this.authModel = new AuthModel();
                this.view = new EventView();
                this.initializeEventListeners();
                this.checkAuthentication();
            }

            initializeEventListeners() {
                // Authentication event listeners
                this.view.loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleLogin();
                });

                this.view.logoutBtn.addEventListener('click', () => {
                    this.handleLogout();
                });

                // Event form listeners
                this.view.eventForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleEventSubmit();
                });

                this.view.cancelBtn.addEventListener('click', () => {
                    this.cancelEdit();
                });
            }

            checkAuthentication() {
                if (this.authModel.isAuthenticated()) {
                    this.view.showAppView(this.authModel.getCurrentUser().username);
                    this.loadEvents();
                } else {
                    this.view.showLoginView();
                }
            }

            handleLogin() {
                this.view.hideLoginError();
                const loginData = this.view.getLoginData();
                
                // Validate input
                if (!loginData.username || !loginData.password) {
                    this.view.showLoginError('Please enter both username and password');
                    return;
                }
                
                const result = this.authModel.login(loginData.username, loginData.password);
                if (result.success) {
                    this.view.clearLoginForm();
                    this.view.showAppView(result.user.username);
                    this.loadEvents();
                } else {
                    this.view.showLoginError(result.error);
                }
            }

            handleLogout() {
                this.authModel.logout();
                this.view.showLoginView();
                this.view.clearEventForm();
            }

            handleEventSubmit() {
                const formData = this.view.getFormData();
                const eventId = this.view.eventId.value;

                // Validate form data
                const validationErrors = this.eventModel.validateEvent(formData);
                if (validationErrors.length > 0) {
                    this.view.showFormMessage(validationErrors.join(', '), true);
                    return;
                }

                try {
                    if (eventId) {
                        // Update existing event
                        const updatedEvent = this.eventModel.updateEvent(eventId, formData);
                        if (updatedEvent) {
                            this.view.showFormMessage('Event updated successfully!');
                            this.view.clearEventForm();
                            this.loadEvents();
                        } else {
                            this.view.showFormMessage('Error updating event - event not found', true);
                        }
                    } else {
                        // Create new event
                        const newEvent = this.eventModel.createEvent(formData);
                        if (newEvent) {
                            this.view.showFormMessage('Event added successfully!');
                            this.view.clearEventForm();
                            this.loadEvents();
                        } else {
                            this.view.showFormMessage('Error creating event', true);
                        }
                    }
                } catch (error) {
                    console.error('Event save error:', error);
                    this.view.showFormMessage('An error occurred while saving the event. Please try again.', true);
                }
            }

            editEvent(eventId) {
                if (!eventId) {
                    this.view.showFormMessage('Invalid event ID', true);
                    return;
                }

                try {
                    const event = this.eventModel.getEventById(eventId);
                    if (event) {
                        this.view.populateEventForm(event);
                        // Scroll to form for better UX
                        document.querySelector('.event-form').scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'start' 
                        });
                    } else {
                        this.view.showFormMessage('Event not found - it may have been deleted', true);
                        this.loadEvents(); // Refresh the list
                    }
                } catch (error) {
                    console.error('Edit event error:', error);
                    this.view.showFormMessage('Error loading event for editing. Please try again.', true);
                }
            }

            deleteEvent(eventId) {
                if (!eventId) {
                    this.view.showFormMessage('Invalid event ID', true);
                    return;
                }

                if (confirm('Are you sure you want to delete this event? This action cannot be undone.')) {
                    try {
                        const deletedEvent = this.eventModel.deleteEvent(eventId);
                        if (deletedEvent) {
                            this.view.showFormMessage(`Event "${deletedEvent.title}" deleted successfully!`);
                            this.loadEvents();
                        } else {
                            this.view.showFormMessage('Error deleting event - event not found', true);
                        }
                    } catch (error) {
                        console.error('Delete event error:', error);
                        this.view.showFormMessage('An error occurred while deleting the event. Please try again.', true);
                    }
                }
            }

            cancelEdit() {
                this.view.clearEventForm();
            }

            loadEvents() {
                try {
                    const events = this.eventModel.getAllEvents();
                    this.view.renderEvents(events);
                    this.updateStorageStats();
                } catch (error) {
                    console.error('Error loading events:', error);
                    this.view.showFormMessage('Error loading events. Please refresh the page.', true);
                }
            }

            refreshEvents() {
                this.loadEvents();
                this.view.showFormMessage('Events refreshed successfully!');
            }

            updateStorageStats() {
                try {
                    const stats = this.eventModel.getStorageStats();
                    const storageElement = document.getElementById('storage-stats');
                    if (storageElement) {
                        storageElement.textContent = `${stats.totalEvents} events stored locally`;
                    }
                } catch (error) {
                    console.error('Error updating storage stats:', error);
                }
            }
        }

        // ===============================
        // APPLICATION INITIALIZATION
        // ===============================
        let controller;

        document.addEventListener('DOMContentLoaded', () => {
            controller = new EventController();
        });
    </script>
</body>
</html>